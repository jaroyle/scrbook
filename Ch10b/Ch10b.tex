\chapter{
Modeling Space Usage:
Integrating Resource Selection Information with
Spatial Capture-Recapture
  Models}

\markboth{Resource Selection and Space Usage}{}
\label{chapt.rsf}


\vspace{.3in}

Up to this point we have developed many variations of SCR models to
describe the observation process.  These included models of the
relationship between encounter probability and distance, and different
types of covariates such as behavioral responses that can affect
detection probability.  Although these different observation models
are immensely useful, they are rather basic in the sense that they
imply simplistic models of how individuals use space (section
\ref{scr0.sec.implied}) and how individuals are distributed in space.
In the following several chapters we generalize some of the core SCR
assumptions to accommodate more realistic notions of how animals use
space.

In this chapter we extend our notion of encounter probability models
as models of space usage or resource selection
(sec. \ref{scr0.sec.implied}), by extending them to include one or
more explicit landscape covariates, which the investigator believes
might affect how individual animals use space within their home range
(this is what \citep{johnson:1980} called {\it third-order}
selection). We do this in a way that is entirely consistent with the
manner in which classical ``resource selection function'' (RSF) models
\citep{manly_etal:2002} or utilization distributions
\citep{worton:1989, fieberg:2005, fieberg:2007} are estimated from
animal telemetry data.  In fact, we argue there that SCR models and
RSF/UD models estimated from telemetry are based on the same basic
underlying model of space usage. The important distinction between SCR
and RSF studies are that, in SCR studies, encounter of individuals is
imperfect (i.e., ``$p<1$'') whereas, with RSF data obtained by
telemetry, encounter is perfect\footnote{this is not strictly true --
  rather, detection is not a {\it stochastic} outcome.}. We can think
of the two as being exactly equivalent either if we have a dense array
of trapping devices, or if our telemetry apparatus is imperfect such
as only samples a small area of space (this would be consistent with
telemetry stations for sampling fish which only measure passage). 
 A
key concept that we must confront in order to unify and integrate SCR
and RSF data is that we need to formulate both models in terms of a
common latent variable so that we can make them consistent with
respect to some underlying space utilization process. As we will
explain, this latent variable is the number of times that an
individual uses a particular pixel of the landscape over some period
of time.

We begin by
describing a model for space usage that exists independent of how we
obtain the data (whether by telemetry or by capture-recapture). The
model posits that individuals use space in proportion to one or more
measurable covariates, say $z({\bf x})$, defined for every pixel or
location ${\bf x}$.  Then we introduce observation models consistent
with both standard capture-recapture methods and telemetry.  This
allows us to define a general likelihood function that is the product
of the two components, if they are both simultaneously available.  In
the absence of RSF data from telemetry, the model reduces to an
ordinary SCR model but with a spatial covariate $z({\bf x})$ affecting
encounter probability.
By integrating RSF data obtained from
telemetry into SCR models to model space usage explicitly, this 
implies a model of asymmetric, irregular and non-stationary home ranges, and
allows us to make formal inferences about factors that influence home
range geometry and morphology directly from SCR data.  


Following \citet{borchers_efford:2008}, we provide a formal
likelihood-based analysis of the model, and carry-out a simulation
study for various sample sizes of telemetered individuals to evaluate
the improvement from adding telmetry information to SCR studies and
{\it vice versa}.  The modeling framework we develop here
simultaneously resolves three important technical problems: (1) it
generalizes all existing encounter probability models for SCR data to
accommodate realistic patterns of space usage that are {\it not}
symmetric and spatially constant; (2) It allows us to estimate RSF
parameters directly from SCR data, i.e., {\it absent} telemetry data;
and (3) it allows us to integrate telemetry data directly into SCR
models to improve estimates of model parameters, including density.
Our model greatly expands the applied relevance of SCR methods for
conservation and management, and for addressing applied and
theoretical questions related to animal space usage.


\begin{comment}
In our formulation we estimate the latent ${\bf s}$ variables from the observed telemetry
data, just as a convenience, but this wouldn't be necessary.
Also we assume the data are independent pieces but if some of the SCR
individuals are the same as the telemetered individuals then we should
probably account for that explicitly. So right now we pretend we don't
know anything about the telemetered guys in terms of their capture
history. So they don't contribute to information about baseline
encounter probability, just to estimates of the other encounter model
parameters.
\end{comment}

\begin{comment}
for manuscript we need a section on the
basic SCR model here
\end{comment}

\section{Basic Model of Space Usage}
\label{rsf.sec.rsfmodel}

We develop the model here in terms of a discrete landscape purely for
computational expediency. That said, essentially no landscape on your
%% remove this sentence for manuscript
computer is continuous, except in the rare case that the landscape is
defined strictly in terms of variables that themselves are inherently
continuous -- e.g., ``distance to road'' or something like that.  But
almost all habitat or landscape structure data comes to us in the form
of raster data.  Let ${\bf x}_{1},\ldots,{\bf x}_{nG}$ identify the
center coordinates of a set of $nG$ pixels that define a landscape.
We organize them into a matrix ${\bf X}_{nG \times 2}$.  Let $z({\bf
  x})$ denote a covariate measured (or defined) for every pixel ${\bf
  x}$. For clarity, we develop the basic ideas here in terms of a
single covariate but, in practice, investigators typically have more
than 1 covariate. The formulation of the model is unaffected by
whether we have one or multiple such covariates.

We suppose that a population of individuals wanders around space in
some manner related to the covariate $z({\bf x})$, and their locations
accumulate in pixels by some omnipotent accounting mechanism. We will
define ``use of ${\bf x}$'' to be the event that an individual animal
appeared in some pixel ${\bf x}$. This is equivalently stated in the
literature in terms of individual having {\it selected} ${\bf x}$ but
the latter term implies some kind of conscious intent, and so we keep
to the term {\it use} as much as possible.  As a biological matter,
use is the outcome of individuals moving around their home range \citep{hooten_etal:2010},
i.e., where an individual is at any point in time is the result of
some movement process. However, to understand space usage, it is not
necessary to entertain explicit models of movement, just to observe
the outcomes, and so we don't elaborate further on what could be
sensible or useful models of movement, but we imagine existing methods
of hierarchical or state-space
models are suitable for this purpose \citep{jonsen_etal:2005,
  forester_etal:2007, patterson_etal:2008, hooten_etal:2010, mcclintock_etal:2012}.





Let $n_{ij}$ be the use frequency of pixel $j$ by individual $i$ --
i.e., 
the number of times individual $i$ used pixel $j$
during some period of time.  We assume the
following probability mass function for the distribution of use
frequencies:
\[
{\bf n}_{i} \sim \mbox{Multinom}({\bm \pi}_{i})
\]
where
\[
 \pi_{ij} = \frac{ \exp( \alpha_{2} z({\bf x}) ) }{ \sum_{x}
   \exp(\alpha_{2} z({\bf x}))}
\]
This is the standard RSF model \citep{manly_etal:2002} used to model
telemetry data.  The parameter $\alpha_2$ is the effect of the
landscape covariate $z({\bf x})$ on the relative probability of
use. Thus, if $\alpha_2$ is positive, the relative probability of use
increases as the covariate increases. In practice, we don't get to
observe $n_{ij}$ for all individuals but, instead, only for a small
subset which we capture and install telemetry devices on.
\begin{comment}
 For these
telemetered individuals we accumulate individual- and pixel-specific
frequencies, at a lower sampling rate than actual individual use. For
example, we might choose to record the location of an individual every
hour or day or whatever. As such, the observed frequency of pixel use
is a {\it sample} of use but, if the recording is random or systematic
(or otherwise unrelated to {\it where} individuals are located), then
we can imagine that the same model of space usage applies. Formally,
we suppose that the observed frequencies are a binomial sample with
sample size $n_{ij}$ and sampling intensity $\phi_{0}$ lets say, and
we see that the constant $\phi_{0}$ cancels from the expression for
the multinomial cell probabilities above. 
\end{comment}
For the telemetered individuals, we assume their behavior is according
to the same RSF model as the population as a whole, with
probabilities:
\[
 \pi_{ij} = \frac{ \exp( \alpha_{2} z({\bf x}_{j}) ) }{ \sum_{x}   \exp(\alpha_{2} z({\bf x}_{j}))}
\]
We extend this model slightly to make it more realistic spatially. Let
${\bf s}$ denote the centroid of an individuals home range and let
$D_{ij} = ||{\bf x}_{j} - {\bf s}_{i}||$ be the distance from the home
range center of individual $i$, ${\bf s}_{i}$, to pixel $j$, ${\bf
  x}_{j}$. We modify the space usage model to accommodate that space
use will be concentrated around an individuals home range centroid:
\begin{equation}
 \pi_{ij} = \frac{ exp( -\alpha_{1} D_{ij}^{2} +\alpha_{2} z({\bf x}_{j}) ) }
{ \sum_{x} exp(-\alpha_{1} D_{ij}^{2} +\alpha_{2} z({\bf x}_{j}))}
\label{rsf.eq.rsf}
\end{equation}
where $\alpha_1=1/(2\sigma^2)$ describes the rate at which capture
probability declines as a function of distance. Note that
Eq.~\ref{rsf.eq.rsf} resembles standard encounter models used in
spatial capture-recapture but with an additional covariate $z({\bf
  x})$ (and see Chapt. \ref{chapt.poisson-mn}).  In particular, under
this model for space usage or resource selection, if you have no
covariates at all, or if $\alpha_{2} = 0$, then the probabilities
$\pi_{ij}$ are directly proportional to the SCR model for encounter
probability.  For example, setting $\alpha_{2} = 0$, then this implies
probability of use for pixel $j$ is:
\[
p_{ij} \propto  \exp( -\alpha_{1} D_{ij}^{2})
\]
so whatever function of distance we use in our RSF implies an
equivalent model of space usage (sec. \ref{scr0.sec.implied}) when
used in SCR models. In particular, for whatever model we choose for
$p_{ij}$ in an ordinary SCR model, we can modify the distance
component in the RSF function in Eq. \ref{rsf.eq.rsf} accordingly to
be consistent with that model, by using whatever function $p_{ij}$ we
choose according to
\[
\pi_{ij} \propto \exp( log(p_{ij}) + \alpha_{2} z({\bf x}_{j}) )
\]
One difference between this observation model and those that we have
considered in previous chapters is that it includes the normalizing
constant $\sum_{x} exp(-\alpha_{1} D_{ij}^{2} +\alpha_{2} z({\bf
  x}_{j}))$, which ensures that the use distribution is a proper
probability density function. Thus we are able to characterize the
probability of encounter in terms of both distance and space use.

As an illustration of space usage patterns under this model, we
simulated a covariate that represents variation in habitat structure
(Fig. \ref{rsf.fig.habitat}) such as might correspond to habitat
quality.
\begin{figure}
\centering
\includegraphics[width=3.5in,height=3.25in]{figs/habitat.png}
\caption{A typical habitat covariate reflecting habitat quality or
  hypothetical utility of the landscape to a species under study. Home range centers for 8 individuals are
shown with black dots.}
\label{rsf.fig.habitat}
\end{figure}
This was simulated by using a
kriging interpolator with the following {\bf R} commands:
\begin{verbatim}
set.seed(1234)
gr<-expand.grid(1:40,1:40)
Dmat<-as.matrix(dist(gr))
V<-exp(-Dmat/5)
z<-t(chol(V))%*%rnorm(1600)
\end{verbatim}
%The functions \mbox{\tt make.statespace} and \mbox{\tt spatial.plot} are
%both in the \mbox{\tt scrbook} package.
Space usage patterns for
 8 individuals are shown in Fig. \ref{rsf.fig.homeranges},
simulated with $\alpha_{1} = 1/(2\sigma^2)$ with $\sigma = 2$ and the
coefficient on $z({\bf x})$ set to $\alpha_{2} = 1$.
\begin{figure}
\centering
\includegraphics[width=3.5in,height=3.5in]{figs/homeranges8}
\caption{Space usage patterns of 8 individuals under a space usage
  model that contains a single covariate (shown in
  Fig. \ref{rsf.fig.habitat}). Plotted value is the multinomial
  probability $\pi_{ij}$ for pixel $j$ under the model in Eq. \ref{rsf.eq.rsf}.
}
\label{rsf.fig.homeranges}
\end{figure}
These space usage densities -- ``home ranges'' -- exhibit clear
non-stationarity in response to the structure of the underlying
covariate, and they are distinctly asymmetrical.  We note that if
$\alpha_{2}$ were set to 0, the 8 home ranges shown here would
resemble bivariate normal kernels with $\sigma = 2$.  Another
interesting thing to note is that the activity centers are not
typically located in the pixel of highest use or even the centroid of
usage. That is, the observed ``average'' location is not an unbiased
estimator of ${\bf s}$ under the model in Eq. \ref{rsf.eq.rsf}.


\subsection{Poisson use model}

A natural way to motivate this specific model of space usage is to
assume that individuals make a sequence of random resource selection
decisions so that the outcome of $n_{ij}$ are marginally {\it
  independent}, having a Poisson distribution:
\[
 n_{ij} \sim \mbox{Poisson}( \lambda_{ij})
\]
where
\[
 log(\lambda_{ij}) = a_{0} -\alpha_{1} D_{ij}^{2} +  \alpha_{2} z({\bf x})
\]
In this case, the number of visits to any particular cell is affected
by the covariate $z({\bf x})$ but has a baseline rate ($\exp(a_{0})$)
related to the amount of movement occuring over some time interval.
%, or number of selection decisions
%which is essentially just related to the time interval over which the
%animal is using space. i.e., longer time intervals lead to higher
%values of $E(n_{ij})$.  
This is an equivalent model to the multinomial
model given previously in the sense that, if we condition on the total
sample size $n_{i.} = \sum_{j} n_{ij}$, then the vector ${\bf n}_{i}$
has a multinomial distribution with probabilities
\[
 \pi_{ij} = \frac{\lambda_{ij}}{ \sum_{j} \lambda_{ij}}
\]
which is the same as Eq. \ref{rsf.eq.rsf} (see also
Chapt. \ref{chapt.poisson-mn}) because $a_{0}$ cancels 
from the numerator and denominator of the
multinomial cell probabilities
%, analogous to what happens under
%sampling of individual use decisions as discussed above.
and thus this parameter is not relevant to understanding 
space usage. 

\begin{comment}
{\bf note:} while Poisson -> multinomial, it is not vice versa. If the total
sample size per individual is fixed, then the marginals are NOT
Poisson and that model will produce biased estimators.

For purposes of estimation we can use either the Poisson or
multinomial likelihoods. In the former case, we have to estimate an
individual-specific nuisance
parameter $a_{0}$, from which information is derived by the total
number of observations whereas, in the later case, we lose information
about $a_{0}$ by conditioning on the total (i.e., treating it as
fixed).  As it often is fixed, or at least the number of telemetry
observations is completely arbitrary, $a_{0}$ is usually a meaningless
parameter so whether we estimate it or not is immaterial from a
practical standpoint.
\end{comment}

\subsection{Thinning}

Suppose our sampling is imperfect so that we only observe a smaller
number of telemetry fixes than actual uses, $n_{ij}$. As developed in
sec. \ref{scr0.sec.implied}, we assume that the observed number of
uses is
\[
 m_{ij} \sim \mbox{Bin}(n_{ij}, \phi_{0}).
\]
In this case, the marginal distribution of $m_{ij}$ is also Poisson
but with mean
\[
 log(\lambda_{ij}) = log(\phi_{0}) + a_{0} -\alpha_{1} D_{ij}^{2} +  \alpha_{2} z({\bf x}).
\]
In this case, the space-usage model (RSF) for the
thinned counts $m_{ij}$ is the same as the space-usage model for the
original variables $n_{ij}$.  This is because if we remove $n_{ij}$
from the conditional
 model by summing over its possible values, then the vector of
${\bf m}_{i}$ is {\it also}  multinomial with cell probabilities
\[
\pi_{ij} = \frac{\phi_{0}\lambda_{ij}}{\sum_{j} \phi_{0} \lambda_{ij}}
\]
and so the nuisance parameter $\phi_{0}$ cancels from the numerator and
denominator. Thus, the underlying RSF model applies to the true
unobserved count frequencies ${\bf n}_{i}$ and also those produced
from thinning or sampling, ${\bf m}_{i}$. 

%That is,
%given our sequence of
%independent Poisson random variables and we condition on their total,
%i.e., regard it as fixed, then we have the multinomial. In the
%multinomial we lose information about the intercept which in this case
%is ok because we only care about the interpretation of the resource
%selection model as a probability distribution and don't care about the
%basic rate of detection -- and it is a confounding of animal use and a
%fixed sampling intensity.

In summary, if we conduct a telemetry study we observe ${\bf n}_{i}$,
the $nG \times 1$ vector of pixel-counts for each individual
$i=1,\ldots,N_{tel}$.  We declare these data to be
``resource-selection data'' which are typical of the type used to
estimate resource-selection functions (RSFs) \citep{manly_etal:2002}.
Sometimes in RSF modeling activities we might have 
continuous covariates and so the denominator in Eq. \ref{rsf.eq.rsf}
involves an integration over a distribution for the covariate which is
the conditional intensity of observed point locations in a point
process model. However, in a discrete landscape, entertaining pdfs for
the covariates isn't necessary \citep{royle_etal:2012mee} when we
recognize that the denominator should be the expectation over {\it
  space} and not the pdf of some covariate. 


\subsection{Capture-recapture Data}

\begin{comment} in manuscript we need intro here on SCR \end{comment}

The key to combing RSF data with SCR data is to work with this
underlying resource utilization process and formulate SCR models in
terms of that process. For SCR models, the frequency of use for each pixel
serves as a intermediate
latent that we don't get to observe. We assume that, fundamentally,
both telemetered individuals and SCR individuals are using space
according to the same resource selection model. The difference is that,
for SCR data, we 
do not have sampling devices in all locations (pixels) in the landscape, and hence the
data are only recorded at a subsample of them.
In other words, imagine that we have a sampling device, such as a
camera trap, in {\it every} pixel. If the device operates continually
then it is no different from a telemetry instrument. If it
operates  intermittently and does not expose the entire area of
each pixel then a reasonable model for this imperfect observation is
the ``thinned'' binomial model given above, where $\lambda_{0} \equiv \exp(\phi_{0})$
represents the sampling effectiveness of the device. So we imagine
that the hypothetical perfect data from a camera trapping study are
the counts $m_{ij}$.

We then construct our SCR encounter probability model based on the
view that these frequencies $m_{ij}$ are {\it latent}. In particular,
under the SCR model with binary observations,
 we observe a random variable
$y_{ij} = 1$  if the individual $i$ visited the pixel
containing a trap and was detected.
We imagine that $y_{ij}$ is related to the latent variable $m_{ij}$ being the
event $m_{ij}>0$, which occurs with probability
\[
 p_{ij} = 1-\exp(- \lambda_{ij})
\]
or, equivalently, this is the complementary log-log link relating
$p_{ij}$ to $log(\lambda_{ij})$:
\[
 cloglog(p_{ij}) = log(\lambda_{ij})
\]
where 
\[
 log(\lambda_{ij}) = log(\phi_{0}) + a_{0} -\alpha_{1} D_{ij}^{2} +  \alpha_{2} z({\bf x}).
\]
and we collect the constants so that $\alpha_{0} = log(\phi_{0}) +
a_{0}$ is the 
 baseline encounter rate which includes
the constant intensity of use by the individual and also the baseline
rate of detection, conditional on use.


\section{The Joint RSF/SCR Likelihood}

To construct the likelihood for SCR data when we have auxiliary
covariates on space usage {\it or} direct information on space usage
from telemetry data, we regard the two samples (SCR and RSF) as
independent of one another. In practice, this might not always be the
case but (1) often time the telemetry data come from a previous study;
(2) the individuals are not the same at all; (3) or even if they are
some of the same individuals being captured, we might not be able to
match individuals captured by a sampling method such as hair-snares
with the individuals wearing radio-collars; (4) In cases where we {\it
  can} match some individuals between the two samples, regarding them as
independent should only entail a minor
loss of efficiency
because we are disregarding more precise information on a small number
of activity centers. Moreover, we believe, it is unlikely in practice
to expect the two samples to be completely reconcilable and that the
independence formulation is the most generally realistic.

Regarding the two data sets as being independent, our approach here
is to form the likelihood for each set of observations as a function
of the same underlying parameters and then combine them. In
particular, let ${\cal L}_{scr}(\alpha_{0}, \alpha_{1}, \alpha_{2}, N;
{\bf y}_{scr})$
be the likelihood for the SCR data in terms of the basic encounter
probability parameters and the total (unknown) population size $N$,
and let ${\cal L}_{rsf}(\alpha_{1},\alpha_{2}; {\bf m}_{rsf})$ be the
likelihood for the RSF data based on telemetry which, because the
sample size of such individuals is fixed, does not depend on $N$.
The
joint likelihood is the product of these two pieces:
\[
{\cal L}_{rsf+scr}(\alpha_{0},\alpha_{1},\alpha_{2},N; {\bf y}_{scr},{\bf
  m}_{rsf})  = {\cal L}_{scr} \times {\cal L}_{rsf}
\]
In what follows, we provide a formulation of each likelihood
component, along with an {\bf R} function for obtaining the MLEs of
model parameters using standard methods available in {\bf R}.

% this needs stated up-front in the manuscript
The observation model for the SCR data for individual $i$ and trap $j$,
from sampling over $K$ encounter periods, is:
\[
 y_{ij}|{\bf s}_{i} \sim \mbox{Bin}(K; p_{ij})
\]
where
\[
 p_{ij} = 1-\exp(- \lambda_{ij} )
\]
and
\[
 \lambda_{ij} = \lambda_{0} \exp(- \alpha_{1} D_{ij}^{2} + \alpha_{2}
 z({\bf x}_{j}) )
\]
A compact expression of these model components is:
\begin{equation}
y_{ij}| {\bf s}_{i} \sim \mbox{Bin}(K, p(D_{ij}, z({\bf x}_{j}); {\bm \alpha}))
\label{rsf.mle.eq.cond-on-s}
\end{equation}
We emphasize that this is conditional on the latent variables ${\bf
  s}_{i}$ (which appear in $D_{ij}$). For these latent variables we
adopt the standard assumption of uniformity, ${\bf s}_{i} \sim
\mbox{Unif}({\cal S})$ \citep{borchers_efford:2008, royle_young:2008}.  

The joint distribution of the data for
individual $i$, conditional on ${\bf s}_{i}$, is the product of $J$
binomial terms (i.e., the contributions from each of $J$ traps):
\[
  [{\bf y}_{i} | {\bf s}_{i} , {\bm \alpha}] =
  \prod_{j=1}^{J} \mbox{Bin}(K, p({\bf x}_{j},{\bf s}_{i}) )
\]
The so-called marginal likelihood \citep{borchers_efford:2008} is
computed by removing ${\bf s}_{i}$, by integration, from the
conditional-on-${\bf s}$ likelihood and regarding the {\it marginal}
distribution of the data as the likelihood. That is, we compute:
\[
  [{\bf y}_{i}|{\bm \alpha}] =
\int_{{\cal S}}  [ {\bf y}_{i} |{\bf s}_{i},{\bm \alpha}] g({\bf s}_{i}) d{\bf s}_{i}
\]
{\flushleft where}, under the uniformity assumption, we have
$g({\bf s}) = 1/||{\cal S}||$.
The joint likelihood for all $N$ individuals,
is the product of $N$ such terms:
\[
{\cal L}_{scr}({\bm \alpha} | {\bf y}_{1},{\bf y}_{2},\ldots, {\bf y}_{N}) = \prod_{i=1}^{N}
[{\bf y}_{i}|{\bm \alpha}]
\]
In practice, we don't know $N$ and so we can't just compute the
SCR likelihood in this manner. Following our development in
Chapt. \ref{chapt.mle},
we compute the contributions of the
$n$ observed individuals, but then we have to compute the likelihood
contribution for the ``all 0'' encounter history, i.e., that
corresponding to unobserved individuals. The mechanics of computing
that are the same as for an ordinary observed encounter history. We
then have to deal with the issue that $n$ itself is a random variable,
and that leads to the combinatorial term in front of the likelihood
which involves the total population size $N$.

For the RSF data from the sample of individuals with telemetry devices
we adopt the same basic strategy of describing the
conditional-on-${\bf s}$ likelihood and then computing the marginal
likelihood by averaging over possible values of ${\bf s}$.
We have ${\bf m}_{i}$, the vector of pixel counts for individual $i$,
where these counts are derived from a telemetry study or similar.
The conditional-on-${\bf s}_{i}$ distribution of the telemetry data
from individual $i$ is:
\[
 [{\bf m}_{i}  | {\bm \alpha} ]
 = \prod_{g=1}^{G}  \pi_{ij}({\bf s}_{i},z({\bf x}_{j})) ^{m_{ij}}
\]
where
\[
 \pi_{ij}  = \frac{ \exp( -\alpha_{1} D_{ij}^{2} +\alpha_{2} z({\bf x}_{j}) ) }
{ \sum_{g} \exp(-\alpha_{1} D_{ij}^{2} +\alpha_{2} z({\bf x}_{j}))}
\]
The marginal pmf is:
\[
     [{\bf m}_{i}|{\bm \alpha}] =    \int_{{\cal S}}  [ {\bf m}_{i} |{\bf s}_{i},{\bm \alpha}] g({\bf s}_{i}) d{\bf s}_{i}
\]
and therefore the likelihood for the RSF data is
\[
{\cal L}_{rsf}({\bm \alpha} | {\bf m}_{1},{\bf m}_{2},\ldots, {\bf m}_{Ntel}) = \prod_{i=1}^{Ntel}
[{\bf m}_{i}|{\bm \alpha}].
\]

Technical details for computing the likelihood and obtaining the MLEs
are given in Appendix 1 where we provide an ${\bf R}$ function to
evaluate the likelihood and obtain the MLEs.
\begin{comment}
\begin{verbatim}

Script here

\end{verbatim}
\end{comment}
A key practical detail
is that the likelihood here is formulated in terms of the parameter
$N$, the population size for the landscape defined by ${\cal
  S}$. Given ${\cal S}$, density is computed as $D({\cal S}) =
N/||{\cal S}||$. In our simulation study below we report $N$ as the
two are equivalent summaries of the data set once ${\cal S}$ is
defined.


\section{Data Analysis}


We carried-out a simulation study using the landscape shown in
Fig. \ref{rsf.fig.habitat}, and based on a population of $N=100$ and $N=200$
individuals with activity centers distributed uniformly over the
landscape.  This patchy covariate was simulated by generating a field
of spatially correlated noise to emulate a typical patchy habitat
covariate such as tree or understory density, or some other covariate
relevant to habitat quality for a species.  We subjected individuals
to sampling over $K=10$ sampling periods, using a $7 \times 7$ array
of trapping devices located on the the integer coordinates $(u*5,v*5)$
for $u,v = 1,2,3,4,5,6,7$. The model parameters were
\[
\mbox{ cloglog}(p_{ij}) = -2  -\frac{1}{2\sigma^{2}} D_{ij}^{2} + 1 \times z({\bf x}_{j})
\]
for $\sigma =2$. In the absence of the covariate $z$, this corresponds
to an individual having a bivariate normal home range with standard
deviation 2.
These settings yielded an average of about $n=61$ individuals captured for
the $N=100$ case and about $n=123$ for the $N=200$ case. The later case
represents what we believe is an extremely large sample size based on
our own experience and thus it should serve to gauge the large sample
bias of the likelihood estimator (note: we expect little to no large
sample bias). 

In addition to simulating data from this capture-recapture study, we
simulated 2, 4, 8, 12, 16 telemetered individuals to assess the
improvement in precision as sample size increases.  For all cases we
observed 20 telemetry fixes {\it per} individual.  The main things
we're focused on with this simulation study were: (1) how much does
the SE of estimated $N$ improve as we add or increase the number of
telemetered individuals?  (2) How well does the SCR model do at
estimating the parameter of the RSF with {\it no} telemetry data?  (3)
How much does the precision of the RSF parameter improve if we add SCR
data to the telemetry data?


%% Should also simulate fitting the wrong model with symmetric
%% encounter model and see what happens
%% also run N=200 with 500 iterations

{\small
\begin{verbatim}
N=100, 300 iters each, mean SCR only N: 99.418     N=200, 500 iters. Mean SCR only N = 199.712
n=2          Nhat RMSE  ahat RMSE  sighat  RMSE    Nhat RMSE  ahat RMSE  sighat  RMSE
SCR only:   99.73  9.97  0.99  0.14  2.00  0.124  198.85  14.24   0.99   0.10   2.00   0.091
SCR/RSF:    99.94  9.54  0.99  0.12  2.00  0.097  199.37  12.80   0.99   0.09   2.00   0.078
sbar        98.89  9.50  0.93  0.14  1.97  0.100  197.87  13.94   0.96   0.10   1.99   0.080
RSF only     --    --    1.03  0.33  2.00  0.160    --      --    1.04   0.33   1.99   0.169
n=4
SCR only    99.10  9.83  0.99  0.13  2.00  0.127  200.06  15.34   1.00   0.09   2.00   0.092
SCR/RSF     99.17  9.47  0.99  0.11  2.00  0.086  200.25  14.36   1.00   0.08   2.01   0.073
sbar        97.43  9.68  0.89  0.16  1.97  0.090  198.14  14.31   0.94   0.10   1.98   0.075
RSF only     --     --   0.98  0.22  2.00  0.119    --     --     1.02   0.21   2.01   0.122
n=8
SCR only    99.59 10.00  1.00  0.13  2.00  0.130  200.85  14.06   1.00   0.09   2.00   0.087
SCR/RSF     98.90 10.02  0.99  0.10  2.00  0.071  200.29  13.98   1.00   0.08   2.00   0.061
sbar        96.07 10.37  0.84  0.19  1.96  0.078  196.46  14.59   0.90   0.13   1.97   0.069
RSF only     --    --    0.98  0.16  2.01  0.084    --     --     0.99   0.16   2.00   0.084
n=12
SCR only    99.44 10.73  0.98  0.13  2.02  0.128  198.76  14.47   0.99   0.10   2.00   0.091
SCR/RSF     99.96 10.26  1.00  0.09  2.00  0.059  198.72  14.14   1.00   0.08   2.00   0.054
sbar        96.30 10.49  0.82  0.20  1.96  0.071  193.83  15.14   0.87   0.15   1.97   0.063
RSF only     --    --    1.01  0.12  2.00  0.069    --     --     1.01   0.13   2.00   0.069
n=16
SCR only    99.23 10.74  0.99  0.14  2.00  0.128  200.04  14.09   0.99   0.10   2.01   0.088
SCR/RSF     99.20  9.79  1.00  0.09  1.99  0.057  200.25  13.40   1.00   0.07   2.00   0.047
sbar        95.10 10.17  0.80  0.22  1.95  0.075  194.38  14.26   0.85   0.17   1.96   0.059
RSF only     --    --    1.00  0.10  1.99  0.061    --     --     1.00   0.11   2.00   0.055

To check misspecification with isotropic h/r model I refitted the N =
200 cases and fit the SCR only and SCR/RSF models IN ADDITION to the
SCR0 model with isotropic encounter model.
n=2
SCR only 199.11  14.28   0.99   0.09   2.00   0.090
SCR/RSF  199.11  13.80   0.99   0.09   2.00   0.079
SCR0     161.48  39.98    --     --    1.84   0.180

n=4
SCR only 199.67  13.87   1.00   0.09   2.00   0.090
SCR/RSF  199.65  13.59   1.00   0.09   2.00   0.072
SCR0     161.32  40.00    --     --    1.83   0.191

n=8 
SCR only 199.24  15.49   0.99   0.10   2.01   0.093
SCR/RSF  199.55  14.17   0.99   0.08   2.00   0.063
SCR0     161.46  40.06    --     --    1.84   0.184

n=12
SCR only 200.41  15.16   0.99   0.10   2.00   0.086
SCR/RSF  200.95  13.04   1.00   0.08   2.00   0.051
SCR0     162.40  38.95    --     --    1.84   0.185

n=16
SCR only 199.16  15.62   1.00   0.09   2.00   0.095
SCR/RSF  199.63  13.38   1.00   0.07   2.00   0.052
SCR0     160.93  40.44    --     --    1.84   0.190
\end{verbatim}
}


The replicate runs of the SCR-only situation give us an idea of the
inherent MC error in these simulations, which is roughly about
0.25 and 0.89 on the $N$ scale for the $N=100/N=200$ cases.
 The mean $N$ under ``\mbox{\tt SCR only}''
across all 5 simulations for $N=100$ was $\mbox{mean}(\hat{N}) = 99.418$, an empirical bias of
$0.6\%$. For N=200, the estimated $N$ across all 5 simulations (5
levels of ntel)  was
$\mbox{mean}(\hat{N}) = 199.712$, an empirical bias of about $0.15\%$, within the MC error of
the true value of $N=200$.
The results suggests a very small bias of $< 1\%$
in the MLE of $N$ in general when estimation is based on the full
marginal likelihood. However, there is apparent bias of as much as 2-4\% when ${\bf s}$ is
estimated by the average observed location. 
The bias is slightly
diminished  as we double the expected sample size by doubling $N$ from 100 to
200. 
  In practice, we expect a 
small amount of bias in MLEs as likelihood theory only guarantees
asymptotic unbiasedness.
 Moreover, the landscape resolution is fairly coarse relative
to $\sigma$ in our study, having a 1 km resolution whereas $\sigma =
2$, which we expect to introduce a small amount of negative bias
because it is an explicit under-statement of the true heterogeneity in
$p$ due to the spatial context of the problem.  The apparent bias that
arises as a result of esetimating ${\bf s}$ is expected because the
average location of an individual would be unbiased for ${\bf s}$ only
if the individual is moving according to a stationary isotropic
kernel. Under the model of space usage with covariate $z({\bf x})$,
then the average location is biased to favor good values of $z({\bf
  x})$ and so $\bar{\bf s}$ is really biased for ${\bf s}$. 
%%%% XXXX \hl{again,  is there an unbiased estimator available?}
%%%% Good question -- probably
%%% Let us put that on the "to do" list


In terms of RMSE of the MLEs, generally there is about a 5\% reduction
in RMSE when we have at least 2 telemtered individuals,
and, although
there is a lot of MC error in the RMSE quantities, it might be as much
as a 10\% reduction (tops) as $n$ increases under the higher $N=200$ setting. This makes sense because
we nail down the parameters and still don't know where guys are, and
get info about mean p, i.e. $\alpha_{0}$, only from the SCR data. Thus
estimating $N$  benefits only slightly from the addition of telemetry
data.  
%\hl{I don't understand how this could be true. It seems like
%  there should be a tight relationship between the uncertainty about
%  $sigma$ and that of $N$?? That is what we found when we used the
%  informative prior in our AOAS paper.} 

Estimating the RSF parameter $\alpha_{2}$ exhibits negligible or no
bias except when ${\bf s}$ is estimated and, interestingly, it is
well-estimated from SCR data alone and even better than RSF data alone
(in terms of RMSE) until we have more than 200 or so telemetry
observations.  The big improvement comes in esetimating the home range
parameter $\sigma$ which is unbiased except when we estimate ${\bf s}$
in which case it exhibits only modest bias.  However, there is huge
improvement in RMSE of $\hat{\sigma}$, perhaps as much as 50-60\% in
some cases, but that really doesn't translate much into esetimating
$N$.  Improvement due to adding RSF data from telemetry diminishes as
the expected sample sizes increases, and so telemetry data has less
affect at improving precision of $\hat{\sigma}$ and $\hat{\alpha}_{2}$
for $N=200$ than for $N=100$.

We simulated a low $p$ situation in which $\alpha_{0}=-3$ producing
$E[n] = 37$ under the $N=100$ scenario.  The effect is we have only
incremental relative improvements in RMSE of $N$ but relatively more
improvement in RMSE for estimating $\sigma$. The MLE of
$N$ is positively biased.
% remove this in the manuscript
Interestingly this bias opposes slightly negative bias for
the estimator based on estimating ${\bf s}$ and so that wrong
estimator actually does better. This is a complete chance occurrence
and we should not get too excited by that. 
{\small
\begin{verbatim}
N=100, low p, 500 iterations 
n=2        Nhat   RMSE   ahat  RMSE   sighat  RMSE
SCR only 103.85  22.88   1.00   0.19   2.02   0.261
SCR/RSF  102.90  20.98   1.00   0.17   2.00   0.136
sbar     101.55  20.91   0.90   0.19   1.96   0.136
RSF only   --     --     1.02   0.30   1.99   0.163
n=4
SCR only 105.65  26.52   1.01   0.20   2.01   0.258
SCR/RSF  103.55  22.92   1.01   0.14   2.00   0.104
sbar     100.86  22.57   0.86   0.20   1.95   0.113
RSF only   --     --     1.01   0.21   1.99   0.114
n=8
SCR only 107.41  45.05   0.99   0.19   2.01   0.254
SCR/RSF  104.28  22.13   1.00   0.12   2.00   0.076
sbar      99.82  21.55   0.80   0.23   1.95   0.091
RSF only   --     --     1.01   0.15   1.99   0.081
n=12
SCR only 106.35  27.32   0.99   0.19   2.00   0.255
SCR/RSF  104.11  21.81   1.00   0.10   2.00   0.063
sbar      99.21  20.86   0.77   0.24   1.95   0.077
RSF only   --     --     1.01   0.12   2.00   0.065
n=16
SCR only 104.05  31.41   0.99   0.19   2.02   0.252
SCR/RSF  101.98  20.78   1.00   0.09   2.00   0.055
sbar      96.78  20.25   0.76   0.26   1.95   0.070
RSF only   --     --     1.00   0.10   2.00   0.056
\end{verbatim}
}

\begin{comment}
\section{Consequences for Design}

optimal spacing = 2*sigma
\citep{efford:inprep}

with telemetry this is not the case. in particular, it should favor
capturing more guys but fewer ``movements'' realized from the SCR
data. 
\end{comment}


\section{Summary and Outlook}


How animals use space is a fundamental interest to ecologists, and
important in the conservation and management of many species. 
Normally this is done
by telemetry and models referred to as resource selection functions
\citep{manly_etal:2002}.  Conversely, spatial capture-recapture models
have grown in popularity over the last several years
\citep{efford:2004,borchers_efford:2008, royle:2008,
  efford_etal:2009ecol,royle_etal:2009ecol, gardner_etal:2010ecol,
  gardner_etal:2010jwm, kery_etal:2010,
  sollmann_etal:2011,mollet_etal:2012,gopalaswamy_etal:2012}. These,
and indeed, most,
 development and applications of SCR models have focused on density
estimation, not understanding space usage.  However, it is intuitive that space
usage should affect encounter probability and thus it should be highly relevant
to density estimation in SCR applications. Despite this, a description
of the
relationship between encounter probability and space usage has not
been developed explicitly in the literature on spatial
capture-recapture models.  Essentially all
published applications of SCR models to date have been based on
simplistic encounter probability models that are symmetric, constant
among individuals and do not vary across space. One exception is
\citet{royle_etal:2012ecol} who developed SCR models that use
ecological distance metrics (``least-cost path'')
instead of normal Euclidean distance. Here
we developed an SCR model in terms of a basic underlying model of
space or resource use, that is consistent with existing views of
resource selection functions (RSFs) \citep{manly_etal:2002}.

In developing the SCR model in terms of an underlying model of space
usage, we achieve a number of enormously useful extensions of existing
SCR and RSF methods:
(1) We have shown how to integrate classical RSF data from
telemetry with spatial capture-recapture data based on individual
encounter histories obtained by classical arrays of encounter devices
or traps. This leads to an improvement in our ability to estimate
density, and also an improvement in our ability to estimate parameters
of the RSF function.  Thus, the combined model is both an extension of
standard SCR models and also and extension of standard RSF models. As
many animal population studies have auxiliary telemetry information,
the ability to incorporate such information into SCR studies has
enormous applicability and immediate benefits in many studies.
While adding RSF data to SCR data inreased precision in the MLE of $N$
only incrementally, the effect can be substantial in sparse data sets
and, generally, RSF produces 
relatively huge gains in precision in the MLE of $\sigma$. 
(2) We have shown that one can estimate RSF model parameters
directly from SCR data {\it alone}.
While further exploration of this point
is necessary, 
it does establish clearly that SCR
models {\it are} explicit models of space usage. Because
capture-recapture studies are, arguably, more widespread than
telemetry studies alone, this greatly broadens the utility and
importance of data from those studies. 
(3) It is also now clear
that one of the important parameters of SCR models, that controlling
``home range radius'', is also directly estimable from telemetry data
alone.  
The combined RSF+SCR model does yield large improvements in estimation
of $\sigma$. As a practical matter, this suggests we could estimate
$\sigma$ completely from data extrinsic to the SCR study which might
provide great freedom in the design of SCR studies. For example, traps
could be spaced far enough apart to generate no spatial recaptures,
but dramatically increase the coverage of the population, i.e., the
observed sample size of captured individuals relative to $N$.
%This is an idea exploited recently by \citet{chandler_royle:2012} and \citet{sollmann_etal:inprep}.
(4) Finally, we found that an 
ordinary SCR model with symmetric encounter probability model produces
extremely biased estimates of $N$ when the population of individuals
does exhibit resource selection.  As such, it is important to account
for space usage when important covariates are known to influence
space usage patterns.
To syntehsesize these findings we conclude that 
the key benefit of our model so far as inference about density is
concerned is its ability 
integrate realistic patterns of space usage directly into SCR models
and avoid extreme bias in estimating $N$ and, secondarily, we are able
to obtain RSF information from SCR alone and so the use of SCR models
to study space usage and resource selection is promising. 

Use of telemetry data in capture-recapture studies has been suggested
previously. For example, \citet{white_shenk:2001} and
\citet{ivan:2012} suggested using telemetry data to estimate the
%vaguely defined 
quantity ``probability that an individual is exposed to sampling'' but
their estimator requires that individuals are sampled in proportion to
this unknown quantitiy, which seems impossible to acheive in many
studies. In addition, they do not directly integrate the telemetry
data with the capture-recapture model so that common parameters are
jointly estimated. In fact, they don't even acknowledge shared
parameters of the two models.  \citet{sollmann_etal:inprep} did
recognize this, and used some telemetry data to estimate directly the
parameter $\sigma$ from the bivariate normal SCR model in order to
improve estimates of density. This was an important conceptual
development in the sense that it recognized the relationship between
SCR models and models of space usage, but their model did not include
an explicit resource selection component, and they did not implement a
joint estimation framework.

Our new class of integrated SCR/RSF models allows investigators to model how the landscape and
habitat influence movement and space usage of individuals around their
home range, using non-invasively collected capture-recapture data or
capture-recapture data augmented with telemetry data.  This should
improve our ability to understand, and study, aspects of space usage
and it might, ultimately, aid in addressing conservation-related
problems such as reserve or corridor design. And, it should greatly
expand the relevance and utility of spatial capture-recapture beyond
simply its use for density estimation. 
%None of these questions
%regarding space usage could be addressed using non-spatial
%capture-recapture models.


We developed a formal analysis framework here based on marginal
likelihood \citep{borchers_efford:2008} (see Chapt. \ref{chapt.mle}).
In principle, Bayesian analysis does not pose any unique challenges
for this new class of models although we expect some loss of
computational efficiency due to the increased number of times the
components of the likelihood would need to be evaluated.  We imagine
that some problems would benefit from a Bayesian formulation,
however. For example, using an open population model that allows for
recruitment and survival over time \citep{gardner_etal:2010ecol} is
convenient to develop in the {\bf BUGS} language and incorporating
information on unmarked individuals has been done using Bayesian
formulations of SCR models \citep{chandler_royle:2012,
  sollmann_etal:2012}.

In our formulation of the joint likelihood for RSF and SCR data, we
assumed the data from a capture-recapture and telemetry studies were
independent of one another. This implies that whether or not an
individual enters into one of the data sets has no effect on whether
it enters into the other data set. We cannot foresee situations in
which violation of this assumption should be problematic or invalidate
the estimator under the independence assumption.  In some cases it
might so happen that some individuals appear in {\it both} the RSF and
SCR data sets. In this case, ignoring that information should entail
only an incremental decrease in precision because a slight bit of
information about an individuals activity center is
disregarded. Heuristically, an SCR observation (encounter in a trap)
is like one additional telemetry observation, and so the
misspecification (independence)
regards the 
two pieces of information as having separate activity centers.
 Our model pretends that we don't know anything
about the telemetered individuals in terms of their encounter history
in traps.  In principle it shouldn't be difficult to admit a formal
reconciliation of individuals between the two lists. In that case, we
just combine the two conditional likelihoods before we integrate ${\bf
  s}$ from the conditional likelihood. This would be almost trivial to
do if {\it all} individuals were reconcilable (or none as in the case
we have covered here) but, in general , we think you will always have
an intermediate case -- i.e., either none will be or at most a subset
of telemetered guys will be known. More likely you have variations of ``well, that
guy looks telemetered but we don't know which guy it is....hmmm'' and
that case, basically a type of marking uncertainty or
misclassification, is clearly more difficult to deal with.



























\section*{Appendix 1: {\bf R} script for obtaining MLEs under the SCR+RSF model}





















